# ==============================================================================
# IAC Platform - Environment Configuration Template
# ==============================================================================
# Copy this file to .env and customize for your environment
# For production deployment, see .env.production template
# For automated setup, run: ./scripts/setup-env.sh
# ==============================================================================

# ==============================================================================
# SECURITY CONFIGURATION
# ==============================================================================

# Encryption key for securing sensitive data (SSH keys, passwords, tokens)
# IMPORTANT: Change this to a strong, randomly generated 32-character key in production
# Generate with: openssl rand -base64 32
# For quick setup: ./scripts/setup-env.sh will generate this automatically
ENCRYPTION_KEY=change-this-to-a-secure-32-char-key!

# PostgreSQL database password
# IMPORTANT: Change this for production
# Generate with: openssl rand -base64 24
POSTGRES_PASSWORD=registry-password-change-me

# ==============================================================================
# DOMAIN/HOST CONFIGURATION
# ==============================================================================

# Frontend hostname (used for CORS configuration)
# Development: localhost
# Production: your domain (e.g., privatetf.local, registry.example.com)
FRONTEND_HOST=localhost

# Backend hostname (used for URL generation in API responses)
# Development: localhost
# Production: your domain (can be same as FRONTEND_HOST with reverse proxy)
BACKEND_HOST=localhost

# Registry hostname (used for Terraform service discovery)
# Development: registry.local (recommended - Terraform requires hostname with dot)
# Production: your domain (e.g., privatetf.local)
# IMPORTANT: This must match the hostname users configure in their ~/.terraformrc
REGISTRY_HOST=registry.local

# ==============================================================================
# PORT CONFIGURATION
# ==============================================================================

# Frontend web interface port (host port mapping)
# Development: 3000 (or any available port)
# Production: 3000 (behind reverse proxy) or 80/443 (direct)
FRONTEND_PORT=3000

# Backend API port (host port mapping)
# Development: 9080 (or any available port)
# Production: 9080 (behind reverse proxy) or 80/443 (direct)
BACKEND_PORT=9080

# Runner service port (host port mapping)
# Development: 8080 (or any available port)
# Production: 8080 (internal only, not exposed externally)
RUNNER_PORT=8080

# Vite development server port (for CORS during frontend development)
# Only relevant for frontend development (npm run dev)
# Default: 5173
VITE_DEV_PORT=5173

# PostgreSQL external port (optional - for direct database access from host)
# Security: Comment out or remove in production unless absolutely needed
# Uncomment to access PostgreSQL from host machine:
# POSTGRES_PORT_EXTERNAL=5432

# ==============================================================================
# SERVICE URLs (Internal Docker Network)
# ==============================================================================

# Runner URL - Internal Docker network URL for backend to communicate with runner
# Default: http://runner:8080 (uses Docker service name)
# Change only if you modify the runner service name in docker-compose.yml
RUNNER_URL=http://runner:8080

# Registry URL - Internal URL for runner to access modules/providers
# Must use hostname with dot for Terraform compatibility
# Development: http://registry.local:9080 (uses extra_hosts in docker-compose)
# Production: https://privatetf.local (if using reverse proxy with SSL)
REGISTRY_HOST=http://registry.local:9080

# ==============================================================================
# FRONTEND CONFIGURATION
# ==============================================================================

# Frontend API base URL
# Development: Leave empty (uses same origin) or http://localhost:9080
# Production with reverse proxy: Leave empty (recommended)
# Production with separate domains: Set to backend URL (https://api.example.com)
VITE_API_BASE_URL=

# Note: The following variables are automatically passed to frontend at BUILD time:
# - VITE_REGISTRY_HOST: Uses REGISTRY_HOST value (defaults to registry.local)
# - VITE_REGISTRY_PORT: Uses BACKEND_PORT value (defaults to 9080)
# These are used in usage instructions for providers and modules.
# After changing these values, rebuild the frontend: docker-compose build frontend

# ==============================================================================
# CORS CONFIGURATION
# ==============================================================================

# Allowed CORS origins for runner API
# Development: Use * to allow all origins
# Production: MUST specify exact origins (comma-separated)
# Example: https://privatetf.local,https://www.privatetf.local
# 
# SECURITY WARNING: Never use * in production!
ALLOWED_ORIGINS=*

# ==============================================================================
# QUICK START
# ==============================================================================
# 
# 1. Copy this file:
#    cp .env.example .env
# 
# 2. Generate secure keys:
#    ENCRYPTION_KEY: openssl rand -base64 32
#    POSTGRES_PASSWORD: openssl rand -base64 24
# 
# 3. Update domain names (for production):
#    - Set FRONTEND_HOST, BACKEND_HOST, REGISTRY_HOST
#    - Update ALLOWED_ORIGINS with specific domains
#    - Update REGISTRY_HOST if using custom domain
# 
# 4. Validate configuration:
#    ./scripts/validate-env.sh
# 
# 5. Start services:
#    docker-compose up -d
# 
# OR use automated setup:
#    ./scripts/setup-env.sh
# 
# ==============================================================================
# For more information:
# - Production deployment: docs/DEPLOYMENT.md
# - Security best practices: docs/SECURITY.md
# - Full documentation: README.md
# ==============================================================================
